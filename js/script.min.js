var globalLock = !1,
    headerHeight = 40,
    animTime = 250,
    animEasing = "easeInOutCubic",
    pieChartContainer = 200,
    pieStrokeBaseColour = "#e2ddd8",
    pieStrokeHighlightColour = "#c3184d",
    pieRadius = 94,
    pieXYLoc = 100,
    pieStrokeWidth = 12,
    pieStrokeMaxVal = 100,
    pieStrokeEndCap = "round",
    percentageFinal = "",
    waypointOffset = "98%",
    arcAttributes = function (e) {
        e.customAttributes.arc = function (e, t, n, r, i) {
            var s = 360 / r * n,
                o = (90 - s) * Math.PI / 180,
                u = e + i * Math.cos(o),
                a = t - i * Math.sin(o),
                f;
            r === n ? f = [
                ["M", e, t - i],
                ["A", i, i, 0, 1, 1, e - .01, t - i]
            ] : f = [
                ["M", e, t - i],
                ["A", i, i, 0, +(s > 180), 1, u, a]
            ];
            return {
                path: f
            }
        }
    }, richdean = {};
(function () {
    function e(e) {
        var t = e.split(" ");
        return new Date(Date.parse(t[1] + " " + t[2] + ", " + t[5] + " " + t[3] + " UTC"))
    }
    this.preloadMain = function () {
        function e() {
            $(".done").animate({
                "margin-top": "0"
            }, animTime, animEasing, function () {
                $(".preloader").animate({
                    opacity: "0",
                    "margin-top": "-271"
                }, animTime, animEasing, function () {
                    $("header, #intro, #portfolio-header, #ajax-content, #portfolio, #about, #clients, footer").css({
                        opacity: "1"
                    });
                    $(this).remove();
                    $("#white-overlay").animate({
                        opacity: "0"
                    }, animTime, animEasing, function () {
                        $("#portfolio a").each(function () {
                            this.href = this.href.replace("#portfolio-header", "")
                        });
                        $("body").hasClass("article") && ($.browser.webkit ? $("body").animate({
                            scrollTop: $("#portfolio-header").position().top - headerHeight
                        }, animTime * 2, animEasing) : $("html").animate({
                            scrollTop: $("#portfolio-header").position().top - headerHeight
                        }, animTime * 2, animEasing));
                        $(".preloader").css({
                            opacity: "0",
                            "margin-top": "-71px"
                        });
                        $(".done").css({
                            "margin-top": "-80px"
                        });
                        $("#white-overlay").remove()
                    })
                })
            })
        }
        $("body").prepend('<div class="preloader site-loader"><div class="message"><p class="done">Все готово!</p><p class="loading">Загружается...</p></div><div class="outer" id="pre-base"></div><div class="inner"><p>0%</p></div></div>');
        (function (e) {
            circle = new Raphael(e, pieChartContainer, pieChartContainer);
            arcAttributes(circle);
            base = circle.path().attr({
                stroke: pieStrokeBaseColour,
                "stroke-width": pieStrokeWidth,
                "stroke-linecap": pieStrokeEndCap,
                arc: [pieXYLoc, pieXYLoc, 100, pieStrokeMaxVal, pieRadius]
            });
            progress_arc = circle.path().attr({
                stroke: pieStrokeHighlightColour,
                "stroke-width": pieStrokeWidth,
                "stroke-linecap": pieStrokeEndCap,
                arc: [pieXYLoc, pieXYLoc, 0, pieStrokeMaxVal, pieRadius]
            })
        })("pre-base");
        querLoaderComplete();
        $(".preloader").animate({
            opacity: 1
        }, animTime, animEasing, function () {
            $(".done").animate({
                "margin-top": "-40px"
            }, animTime, animEasing);
            $("body").queryLoader2({
                qLtarget: ".preloader .inner p",
                onComplete: e
            })
        })
    }, this.shrinkNavBar = function () {
        $(window).scrollTop() > 1 && $("header").addClass("contracted").removeClass("expanded");
        $(window).scroll(function () {
            $(this).scrollTop() > 1 ? $("header").addClass("contracted").removeClass("expanded") : $("header").addClass("expanded").removeClass("contracted")
        })
    }, this.scrollNav = function () {
        $(window).scroll(function () {
            if (globalLock == 0) {
                var e = !1;
                $(".outer-container").each(function (t, n) {
                    var r = $(n).position(),
                        i = $(window).scrollTop();
                    i += headerHeight;
                    if ($("footer").hasClass("activate-clients")) {
                        $("#primary a[href=#clients]").addClass("current").siblings().removeClass("current");
                        e = !0
                    } else if (i >= r.top) {
                        $("a[href=#" + $(n).attr("id") + "]").addClass("current").siblings().removeClass("current");
                        e = !0
                    }
                });
                e === !1 && $(".current").removeClass("current")
            }
        });
        $("#primary a").click(function (e) {
            $this = $(this);
            $(".current").removeClass("current");
            $this.addClass("current");
            e.preventDefault();
            globalLock = !0;
            $.scrollTo(this.hash, animTime * 4, {
                axis: "y",
                offset: -headerHeight,
                easing: animEasing,
                onAfter: function () {
                    globalLock = !1
                }
            })
        });
        $(".close").click(function (e) {
            $this = $(this);
            e.preventDefault();
            globalLock = !0;
            $.scrollTo(this.hash, animTime * 4, {
                axis: "y",
                offset: -headerHeight,
                easing: animEasing,
                onAfter: function () {
                    globalLock = !1
                }
            })
        })
    }, this.scrollToArticle = function () {
        $(".scroll-to-top, .scroll").click(function (e) {
            $this = $(this);
            e.preventDefault();
            globalLock = !0;
            $.scrollTo(this.hash, animTime * 4, {
                axis: "y",
                offset: -headerHeight,
                easing: animEasing,
                onAfter: function () {
                    globalLock = !1
                }
            })
        })
    }, this.stickyControls = function () {
        $.waypoints.settings.scrollThrottle = 1;
        var e = $(".controls");
        $(".ajax-container").waypoint(function (t) {
            e.toggleClass("sticky", t == "down");
            e.toggleClass("non-sticky", t == "up")
        }, {
            offset: "0"
        });
        $(".top-of-portfolio").waypoint(function (t) {
            t == "up" ? e.removeClass("sticky-bottom") : e.addClass("sticky-bottom")
        }, {
            offset: "370px"
        })
    }, this.enterViewport = function () {
        $("html").hasClass("no-touch") ? $(".invisible").waypoint(function (e) {
            $(this).addClass("visible").removeClass("invisible")
        }, {
            offset: waypointOffset
        }) : $(".invisible").removeClass("invisible");
        $("footer").waypoint(function (e) {
            $("footer").toggleClass("activate-clients", e == "down")
        }, {
            offset: $.waypoints("viewportHeight")
        })
    }, this.serveHiRes = function () {
        $("html").hasClass("touch") && $("img").each(function () {
            this.src = this.src.replace("img/thumbs/", "img/thumbs_hires/");
            this.src = this.src.replace("img/instagram/", "img/instagram_hires/");
            this.src = this.src.replace("img/rich/", "img/rich_hires/");
            this.src = this.src.replace("img/logos/", "img/logos_hires/");
            this.src = this.src.replace("img/skills/", "img/skills_hires/")
        })
    }, this.drawPieCharts = function () {
        function e(e) {
            var t = new Raphael(e, pieChartContainer, pieChartContainer);
            arcAttributes(t);
            var n = t.path().attr({
                stroke: pieStrokeBaseColour,
                "stroke-width": pieStrokeWidth,
                "stroke-linecap": pieStrokeEndCap,
                arc: [pieXYLoc, pieXYLoc, 0, pieStrokeMaxVal, pieRadius]
            }),
                r = Raphael.animation({
                    arc: [pieXYLoc, pieXYLoc, 100, pieStrokeMaxVal, pieRadius]
                }, animTime * 4, "easeInOut");
            n.animate(r.delay(animTime * 2));
            if (e === "user_experience") {
                var i = t.path().attr({
                    stroke: pieStrokeHighlightColour,
                    "stroke-width": pieStrokeWidth,
                    "stroke-linecap": pieStrokeEndCap,
                    arc: [pieXYLoc, pieXYLoc, 0, pieStrokeMaxVal, pieRadius]
                }),
                    s = Raphael.animation({
                        arc: [pieXYLoc, pieXYLoc, 100, pieStrokeMaxVal, pieRadius]
                    }, animTime * 4 * .9, "easeInOut");
                i.animate(s.delay(animTime * 2 + animTime * 4))
            }
            if (e === "visual_design") {
                var o = t.path().attr({
                    stroke: pieStrokeHighlightColour,
                    "stroke-width": pieStrokeWidth,
                    "stroke-linecap": pieStrokeEndCap,
                    arc: [pieXYLoc, pieXYLoc, 0, pieStrokeMaxVal, pieRadius]
                }),
                    u = Raphael.animation({
                        arc: [pieXYLoc, pieXYLoc, 100, pieStrokeMaxVal, pieRadius]
                    }, animTime * 4 * .9, "easeInOut");
                o.animate(u.delay(animTime * 2 + animTime * 4))
            }
            if (e === "development") {
                var a = t.path().attr({
                    stroke: pieStrokeHighlightColour,
                    "stroke-width": pieStrokeWidth,
                    "stroke-linecap": pieStrokeEndCap,
                    arc: [pieXYLoc, pieXYLoc, 0, pieStrokeMaxVal, pieRadius]
                }),
                    f = Raphael.animation({
                        arc: [pieXYLoc, pieXYLoc, 100, pieStrokeMaxVal, pieRadius]
                    }, animTime * 4 * .9, "easeInOut");
                a.animate(f.delay(animTime * 2 + animTime * 4))
            }
            if (e === "responsive_design") {
                var l = t.path().attr({
                    stroke: pieStrokeHighlightColour,
                    "stroke-width": pieStrokeWidth,
                    "stroke-linecap": pieStrokeEndCap,
                    arc: [pieXYLoc, pieXYLoc, 0, pieStrokeMaxVal, pieRadius]
                }),
                    c = Raphael.animation({
                        arc: [pieXYLoc, pieXYLoc, 100, pieStrokeMaxVal, pieRadius]
                    }, animTime * 4 * .9, "easeInOut");
                l.animate(c.delay(animTime * 2 + animTime * 4))
            }
        }
        $("#user_experience").waypoint(function (t) {
            $(this).html() === "" && e("user_experience")
        }, {
            offset: waypointOffset
        });
        $("#visual_design").waypoint(function (t) {
            $(this).html() === "" && e("visual_design")
        }, {
            offset: waypointOffset
        });
        $("#development").waypoint(function (t) {
            $(this).html() === "" && e("development")
        }, {
            offset: waypointOffset
        });
        $("#responsive_design").waypoint(function (t) {
            $(this).html() === "" && e("responsive_design")
        }, {
            offset: waypointOffset
        })
    }, this.loadArticleContent = function () {
        function e() {
            function e() {
                $(".preloader").animate({
                    opacity: "0"
                }, animTime, animEasing, function () {
                    $(this).remove();
                    $(".ajax-container").animate({
                        height: $(".content").height()
                    }, animTime, animEasing, function () {
                        $(".preloader").css({
                            opacity: "0"
                        });
                        $(".content").animate({
                            opacity: "1"
                        }, animTime, animEasing);
                        $("#portfolio").addClass("top-of-portfolio");
                        richdean.stickyControls()
                    })
                })
            }

            function t() {
                console.log("remove");
                $(".ajax-container").animate({
                    height: $(".content").height()
                }, animTime * 2, animEasing, function () {
                    $(".controls").waypoint("destroy");
                    $(".top-of-portfolio").waypoint("destroy");
                    $(".top-of-portfolio").removeClass("top-of-portfolio");
                    $(".controls").removeClass("sticky-bottom");
                    globalLock = !1;
                    $("#primary a").unbind("click");
                    $(".close").unbind("click");
                    richdean.shrinkNavBar();
                    richdean.scrollNav();
                    richdean.scrollToArticle();
                    richdean.stickyControls();
                    richdean.enterViewport();
                    richdean.serveHiRes();
                    richdean.drawPieCharts();
                    richdean.loadArticleContent();
                    richdean.mobileSpecific()
                })
            }

            function n() {
                $(".ajax-container").load(u, function () {
                    history.pushState && history.pushState("", document.title, o);
                    $(".content").fadeTo(0, 0, function () {
                        if (a.hasClass("close")) t();
                        else {
                            console.log("else");
                            $(".ajax-container").prepend('<div class="preloader article-loader"><div class="outer" id="pre-base"></div><div class="inner"><p>0%</p></div></div>');
                            (function (e) {
                                circle = new Raphael(e, pieChartContainer, pieChartContainer);
                                arcAttributes(circle);
                                base = circle.path().attr({
                                    stroke: pieStrokeBaseColour,
                                    "stroke-width": pieStrokeWidth,
                                    "stroke-linecap": pieStrokeEndCap,
                                    arc: [pieXYLoc, pieXYLoc, 100, pieStrokeMaxVal, pieRadius]
                                });
                                progress_arc = circle.path().attr({
                                    stroke: pieStrokeHighlightColour,
                                    "stroke-width": pieStrokeWidth,
                                    "stroke-linecap": pieStrokeEndCap,
                                    arc: [pieXYLoc, pieXYLoc, 0, pieStrokeMaxVal, pieRadius]
                                })
                            })("pre-base");
                            $(".preloader").animate({
                                opacity: "1"
                            }, animTime, animEasing, function () {
                                $("content").queryLoader2({
                                    qLtarget: ".preloader .inner p",
                                    onComplete: e
                                });
                                $(".controls").waypoint("destroy");
                                $(".top-of-portfolio").waypoint("destroy");
                                $(".top-of-portfolio").removeClass("top-of-portfolio");
                                $(".controls").removeClass("sticky-bottom");
                                $("#primary a").unbind("click");
                                $(".close").unbind("click");
                                globalLock = !1;
                                richdean.shrinkNavBar();
                                richdean.scrollNav();
                                richdean.scrollToArticle();
                                richdean.stickyControls();
                                richdean.enterViewport();
                                richdean.serveHiRes();
                                richdean.drawPieCharts();
                                richdean.loadArticleContent();
                                richdean.mobileSpecific()
                            })
                        }
                    })
                })
            }

            function r() {
                $(".content").animate({
                    opacity: 0
                }, animTime, animEasing, function () {
                    a.hasClass("close") ? n() : $(".ajax-container").animate({
                        height: "280px"
                    }, animTime, animEasing, n)
                })
            }

            function i() {
                $.browser.webkit ? $("body").animate({
                    scrollTop: $("#portfolio-header").position().top - headerHeight
                }, animTime * 2, animEasing, r) : $("html").animate({
                    scrollTop: $("#portfolio-header").position().top - headerHeight
                }, animTime * 2, animEasing, r)
            }

            function s(e) {
                e.preventDefault();
                return !1
            }
            $.ajaxSetup({
                cache: !1
            });
            $(".disabled").live("click", s);
            if ($(this).hasClass("disabled")) return !1;
            $(".disabled").removeClass("disabled");
            $(this).addClass("disabled");
            var o = $(this).attr("href"),
                u = o + " .content";
            $(".ajax-container").height($(".content").height());
            var a = $(this);
            $(window).scrollTop() > 100 ? i() : r();
            return !1
        }
        $(".ajax").live("click", e)
    }, 
    String.prototype.relative_time = function () {
        var e = this.split(" ");
        time_value = e[1] + " " + e[2] + ", " + e[5] + " " + e[3];
        var t = Date.parse(time_value),
            n = arguments.length > 1 ? arguments[1] : new Date,
            r = parseInt((n.getTime() - t) / 1e3);
        r += n.getTimezoneOffset() * 60;
        return r < 60 ? "less than a minute ago" : r < 120 ? "about a minute ago" : r < 3600 ? parseInt(r / 60).toString() + " minutes ago" : r < 7200 ? "about an hour ago" : r < 86400 ? "about " + parseInt(r / 3600).toString() + " hours ago" : r < 172800 ? "1 day ago" : parseInt(r / 86400).toString() + " days ago"
    };
    String.prototype.parseURL = function () {
        return this.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&~\?\/.=]+/g, function (e) {
            return e.link(e)
        })
    };
    this.mobileSpecific = function () {
        if (navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPad/i)) {
            var e = document.querySelectorAll('meta[name="viewport"]')[0];
            if (e) {
                e.content = "width=device-width, minimum-scale=1.0, maximum-scale=1.0";
                document.body.addEventListener("gesturestart", function () {
                    e.content = "width=device-width, minimum-scale=0.25, maximum-scale=1.6"
                }, !1)
            }
        }
    }
}).apply(richdean);
$(document).ready(function () {
    richdean.preloadMain();
    richdean.shrinkNavBar();
    richdean.scrollNav();
    richdean.scrollToArticle();
    richdean.stickyControls();
    richdean.enterViewport();
    richdean.serveHiRes();
    richdean.drawPieCharts();
    richdean.loadArticleContent();
    richdean.mobileSpecific()
});
var resizeEvents = {};
(function () {
    this.getContentHeight = function () {
        $(".ajax-container").height($(".content").height())
    }
}).apply(resizeEvents);
$(window).resize(function () {
    resizeEvents.getContentHeight()
});